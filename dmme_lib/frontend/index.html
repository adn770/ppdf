<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DMme - AI Dungeon Master Engine</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="app-container">
        <header class="app-header">
            <h1>DMme</h1>
            <div class="global-controls">
                <button id="new-game-btn">New Game</button>
                <button id="party-manager-btn">Party Manager</button>
                <button id="import-knowledge-btn">Import Knowledge Base</button>
            </div>
        </header>
        <main class="main-content">
            <div id="game-view-container" class="game-view-container">
                <div class="left-panel-game">
                    <div class="party-status-panel">
                        <h4>Party Status</h4>
                        <div class="accordion-item">
                            <button class="accordion-header">
                                <span>Gimli, Son of Gloin</span>
                                <span class="accordion-icon">+</span>
                            </button>
                            <div class="accordion-body">
                                <p>Lvl 1 Fighter</p>
                                <p>HP: 12/12</p>
                            </div>
                        </div>
                        <div class="accordion-item">
                            <button class="accordion-header">
                                <span>Legolas Greenleaf</span>
                                <span class="accordion-icon">+</span>
                            </button>
                            <div class="accordion-body">
                                <p>Lvl 1 Ranger</p>
                                <p>HP: 10/10</p>
                            </div>
                        </div>
                    </div>
                    <div class="dice-roller">
                        <h4>Dice Roller</h4>
                        <div class="dice-grid">
                            <button>d4</button>
                            <button>d6</button>
                            <button>d8</button>
                            <button>d10</button>
                            <button>d12</button>
                            <button>d20</button>
                        </div>
                    </div>
                </div>
                <div class="right-panel-game">
                    <div class="knowledge-panel">
                        <span>Rules: <strong>D&D 5e</strong></span>
                        <span>Module: <strong>Lost Mine of Phandelver</strong></span>
                    </div>
                    <div class="narrative-view">
                        <p class="narrative-text">
                            The adventure begins...
                        </p>
                        <p class="narrative-text read-aloud">
                            <em>The late afternoon sun dips toward the horizon as you travel
                            down the High Road. You've spent the last few days following
                            the road south from the city of Neverwinter, and the an...
                            </em>
                        </p>
                    </div>
                    <div class="input-panel">
                        <textarea id="player-input"
                            placeholder="What do you do?"></textarea>
                        <button id="send-command-btn">Send</button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <div id="modal-overlay" class="modal-overlay"></div>

    <div id="import-wizard-modal" class="modal modal-lg">
        <div class="modal-header">
            <h2 id="import-wizard-title">Import Knowledge Wizard</h2>
            <button class="close-btn">&times;</button>
        </div>
        <div class="modal-body">
            <div class="wizard-pane active" id="wizard-pane-0">
                <h3>Step 1: Select File & Name</h3>
                <div class="form-group">
                    <label for="kb-name">Knowledge Base Name</label>
                    <input type="text" id="kb-name" placeholder="e.g., Core Rules v5.1">
                </div>
                <div class="form-group">
                    <label>Knowledge Base Type</label>
                    <div class="radio-group">
                        <label><input type="radio" name="kb-type" value="rules" checked> Rules</label>
                        <label><input type="radio" name="kb-type" value="module"> Module</label>
                        <label><input type="radio" name="kb-type" value="setting"> Setting</label>
                    </div>
                </div>
                <div class="form-group">
                    <label for="kb-desc">Description (Optional)</label>
                    <textarea id="kb-desc" rows="3"></textarea>
                </div>
                <div id="wizard-upload-area" class="upload-area">
                    <p>Drag & Drop a PDF or Markdown file here, or click to select</p>
                    <input type="file" id="wizard-upload-input" style="display: none;" accept=".pdf,.md">
                    <p id="wizard-upload-filename"></p>
                </div>
            </div>
            <div class="wizard-pane" id="wizard-pane-1">
                <h3>Step 2: Review & Ingest</h3>
                <p>Ready to process <strong id="ingest-filename-confirm"></strong>.</p>
                <div id="image-review-ui" style="display: none;">
                    <h4>Image Review</h4>
                    <div id="image-review-loading" class="loading-spinner">
                        <p>Extracting images, this may take a moment...</p>
                    </div>
                    <div class="image-review-container">
                        <button id="image-prev-btn">&lt;</button>
                        <div class="image-display-area">
                            <img id="review-image" src="" alt="Review Image" />
                            <p id="image-review-counter"></p>
                        </div>
                        <button id="image-next-btn">&gt;</button>
                        <div class="image-metadata-editor">
                            <div class="form-group">
                                <label for="image-description">Description</label>
                                <textarea id="image-description" rows="4"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="image-classification">Classification</label>
                                <select id="image-classification">
                                    <option value="art">Art</option>
                                    <option value="map">Map</option>
                                    <option value="handout">Handout</option>
                                    <option value="decoration">Decoration</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            <button id="save-image-changes-btn" class="accent-btn">Save Changes</button>
                            <span id="image-save-status"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button id="import-wizard-back-btn" class="secondary-btn">Back</button>
            <button id="import-wizard-next-btn" class="accent-btn">Next</button>
        </div>
    </div>

    <div id="party-wizard-modal" class="modal modal-lg">
        <div class="modal-header">
            <h2>Party Manager</h2>
            <button class="close-btn">&times;</button>
        </div>
        <div class="modal-body">
            <div class="panel-container">
                <div class="left-panel">
                    <div class="party-selection-area">
                        <h4>Parties</h4>
                        <ul id="party-list" class="item-list"></ul>
                        <button id="show-create-party-panel-btn" class="accent-btn">+ Create New Party</button>
                    </div>
                    <div class="party-roster-area">
                        <h4>Roster</h4>
                        <ul id="character-list" class="character-list"></ul>
                    </div>
                </div>
                <div class="right-panel">
                    <div id="party-welcome-panel" class="placeholder-pane">
                        <p>Select a party to view its roster, or create a new one.</p>
                    </div>
                    <div id="party-creator-panel" style="display: none;">
                        <h3>Create New Party</h3>
                        <div class="form-group">
                            <label for="new-party-name-input">Party Name</label>
                            <input type="text" id="new-party-name-input" placeholder="e.g., The Brightswords">
                        </div>
                        <button id="create-party-btn" class="accent-btn">Save Party</button>
                    </div>
                    <div id="character-editor-panel" style="display: none;">
                        <h4>Add New Character</h4>
                        <div class="form-group">
                            <label for="char-name">Name</label>
                            <input type="text" id="char-name">
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="char-class">Class</label>
                                <input type="text" id="char-class" list="class-suggestions">
                                <datalist id="class-suggestions">
                                    <option value="Fighter"></option>
                                    <option value="Wizard"></option>
                                    <option value="Rogue"></option>
                                    <option value="Cleric"></option>
                                    <option value="Ranger"></option>
                                    <option value="Barbarian"></option>
                                    <option value="Bard"></option>
                                    <option value="Druid"></option>
                                    <option value="Monk"></option>
                                    <option value="Paladin"></option>
                                    <option value="Sorcerer"></option>
                                    <option value="Warlock"></option>
                                </datalist>
                            </div>
                            <div class="form-group">
                                <label for="char-level">Level</label>
                                <input type="number" id="char-level" value="1">
                            </div>
                        </div>
                        <button id="add-char-manual-btn" class="accent-btn">Add Manually</button>
                        <div class="ai-generator">
                            <h5>AI Character Generator</h5>
                            <div class="form-group form-group-stretch ai-input-container">
                                <textarea id="ai-char-desc" rows="4" placeholder="e.g., A grumpy dwarf cleric who lost his faith..."></textarea>
                                <button id="ai-char-generate-btn" title="Generate with AI">✨</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="new-game-wizard-modal" class="modal modal-md">
        <div class="modal-header">
            <h2>New Game Setup</h2>
            <button class="close-btn">&times;</button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label>Game Mode</label>
                <div class="radio-group">
                    <label><input type="radio" name="game-mode" value="module" checked> Adventure Module</label>
                    <label><input type="radio" name="game-mode" value="freestyle"> Freestyle</label>
                </div>
            </div>
            <div class="form-group">
                <label for="game-rules-kb">Rules System</label>
                <select id="game-rules-kb"></select>
            </div>
            <div id="game-module-group" class="form-group">
                <label for="game-module-kb">Adventure Module</label>
                <select id="game-module-kb"></select>
            </div>
            <div id="game-setting-group" class="form-group" style="display: none;">
                <label for="game-setting-kb">Setting</label>
                <select id="game-setting-kb"></select>
            </div>
            <div class="form-group">
                <label for="game-party-selector">Party</label>
                <select id="game-party-selector"></select>
            </div>
        </div>
        <div class="modal-footer">
            <button id="start-game-btn" class="accent-btn">Start Game</button>
        </div>
    </div>

    <script type="module" src="js/main.js"></script>
</body>
</html>
